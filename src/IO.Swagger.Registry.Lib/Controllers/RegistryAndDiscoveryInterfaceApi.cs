/*
 * DotAAS Part 2 | HTTP/REST | Registry and Discovery
 *
 * The registry and discovery interface as part of Details of the Asset Administration Shell Part 2
 *
 * OpenAPI spec version: Final-Draft
 * 
 * Generated by: https://github.com/swagger-api/swagger-codegen.git
 */
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.IO;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json.Nodes;
using System.Threading.Tasks;
using AasCore.Aas3_0_RC02;
using AasxServer;
using AasxTimeSeries;
using AdminShellNS;
using Extenstions;
using IdentityModel.Client;
using IO.Swagger.Registry.Attributes;
using IO.Swagger.Registry.Models;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Components.Routing;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.IdentityModel.Tokens;
using Microsoft.VisualBasic;
using Newtonsoft.Json;
using Org.BouncyCastle.Asn1.Ocsp;
using Swashbuckle.AspNetCore.Annotations;
using Swashbuckle.AspNetCore.SwaggerGen;
using static QRCoder.PayloadGenerator;
using Key = AasCore.Aas3_0_RC02.Key;

namespace IO.Swagger.Registry.Controllers
{
    /// <summary>
    /// 
    /// </summary>
    [ApiController]
    public class RegistryAndDiscoveryInterfaceApiController : ControllerBase
    {
        /// <summary>
        /// Deletes all Asset identifier key-value-pair linked to an Asset Administration Shell to edit discoverable content
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="204">Asset identifier key-value-pairs deleted successfully</response>
        [HttpDelete]
        [Route("/lookup/shells/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("DeleteAllAssetLinksById")]
        public virtual IActionResult DeleteAllAssetLinksById([FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 204 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(204);

            throw new NotImplementedException();
        }

        /// <summary>
        /// Deletes an Asset Administration Shell Descriptor, i.e. de-registers an AAS
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="204">Asset Administration Shell Descriptor deleted successfully</response>
        [HttpDelete]
        [Route("/registry/shell-descriptors/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("DeleteAssetAdministrationShellDescriptorById")]
        public virtual IActionResult DeleteAssetAdministrationShellDescriptorById([FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 204 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(204);

            throw new NotImplementedException();
        }

        /// <summary>
        /// Deletes a Submodel Descriptor, i.e. de-registers a submodel
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <param name="submodelIdentifier">The Submodel’s unique id (BASE64-URL-encoded)</param>
        /// <response code="204">Submodel Descriptor deleted successfully</response>
        [HttpDelete]
        [Route("/registry/shell-descriptors/{aasIdentifier}/submodel-descriptors/{submodelIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("DeleteSubmodelDescriptorById")]
        public virtual IActionResult DeleteSubmodelDescriptorById([FromRoute][Required] string aasIdentifier, [FromRoute][Required] string submodelIdentifier)
        {
            //TODO: Uncomment the next line to return response 204 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(204);

            throw new NotImplementedException();
        }

        /// <summary>
        /// Returns all Asset Administration Shell Descriptors
        /// </summary>
        /// <response code="200">Requested Asset Administration Shell Descriptors</response>
        /// <param name="assetId">An Asset identifier (BASE64-URL-encoded identifier)</param>
        [HttpGet]
        [Route("/registry/shell-descriptors")]
        [ValidateModelState]
        [SwaggerOperation("GetAllAssetAdministrationShellDescriptors")]
        [SwaggerResponse(statusCode: 200, type: typeof(List<AssetAdministrationShellDescriptor>), description: "Requested Asset Administration Shell Descriptors")]
        public virtual IActionResult GetAllAssetAdministrationShellDescriptors(
            [FromQuery] String assetId)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(List<AssetAdministrationShellDescriptor>));
            /*
            string exampleJson = null;
            exampleJson = "[ \"\", \"\" ]";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<List<AssetAdministrationShellDescriptor>>(exampleJson)
            : default(List<AssetAdministrationShellDescriptor>);            //TODO: Change the data returned
            return new ObjectResult(example);
            */
            try
            {
                var assetList = new List<String>();
                if (assetId != null && assetId != "")
                {
                    assetList.Add(assetId);
                }

                var aasList = getFromAasRegistry(null, assetList);

                return new ObjectResult(aasList);
            }
            catch (Exception ex)
            {
                return BadRequest(ex.Message);
            }
        }

        /// <summary>
        /// Returns a list of Asset Administration Shell ids based on Asset identifier key-value-pairs
        /// </summary>
        /// <param name="assetIds">The key-value-pair of an Asset identifier (BASE64-URL-encoded JSON-serialized key-value-pairs)</param>
        /// <param name="assetId">An Asset identifier (BASE64-URL-encoded identifier)</param>
        /// <response code="200">Requested Asset Administration Shell ids</response>
        [HttpGet]
        [Route("/lookup/shells")]
        [ValidateModelState]
        [SwaggerOperation("GetAllAssetAdministrationShellIdsByAssetLink")]
        [SwaggerResponse(statusCode: 200, type: typeof(List<string>), description: "Requested Asset Administration Shell ids")]
        public virtual IActionResult GetAllAssetAdministrationShellIdsByAssetLink(
            [FromQuery] List<IdentifierKeyValuePair> assetIds,
            [FromQuery] String assetId)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(List<string>));
            /*
            string exampleJson = null;
            exampleJson = "[ \"\", \"\" ]";
            
                        var example = exampleJson != null
                        ? JsonConvert.DeserializeObject<List<string>>(exampleJson)
                        : default(List<string>);            //TODO: Change the data returned
            return new ObjectResult(example);

            [
            {"key": "globalAssetId", "subjectId": "x", "value": "http://example.company/myAsset"},
            {"key": "myOwnInternalAssetId", "subjectId": "x", "value": "12345ABC"}
            ]
            */

            try
            {
                //collect aasetIds from list
                var assetList = new List<String>();
                foreach (var kv in assetIds)
                {
                    if (kv.Value != "")
                        assetList.Add(kv.Value);
                }
                // single assetId
                if (assetId != null && assetId != "")
                {
                    assetList.Add(assetId);
                }

                var aasList = new List<String>();

                var aasDecsriptorList = getFromAasRegistry(null, assetList);

                foreach (var ad in aasDecsriptorList)
                {
                    aasList.Add(ad.Identification);
                }

                return new ObjectResult(aasList);
            }
            catch (Exception ex)
            {
                return BadRequest(ex.Message);
            }
        }

        /// <summary>
        /// Returns a list of Asset identifier key-value-pairs based on an Asset Administration Shell id to edit discoverable content
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="200">Requested Asset identifier key-value-pairs</response>
        [HttpGet]
        [Route("/lookup/shells/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("GetAllAssetLinksById")]
        [SwaggerResponse(statusCode: 200, type: typeof(List<IdentifierKeyValuePair>), description: "Requested Asset identifier key-value-pairs")]
        public virtual IActionResult GetAllAssetLinksById([FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(List<IdentifierKeyValuePair>));
            string exampleJson = null;
            exampleJson = "[ \"\", \"\" ]";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<List<IdentifierKeyValuePair>>(exampleJson)
            : default(List<IdentifierKeyValuePair>);            //TODO: Change the data returned
            return new ObjectResult(example);
        }

        /// <summary>
        /// Returns all Submodel Descriptors
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="200">Requested Submodel Descriptors</response>
        [HttpGet]
        [Route("/registry/shell-descriptors/{aasIdentifier}/submodel-descriptors")]
        [ValidateModelState]
        [SwaggerOperation("GetAllSubmodelDescriptors")]
        [SwaggerResponse(statusCode: 200, type: typeof(List<SubmodelDescriptor>), description: "Requested Submodel Descriptors")]
        public virtual IActionResult GetAllSubmodelDescriptors([FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(List<SubmodelDescriptor>));
            string exampleJson = null;
            exampleJson = "[ {\n  \"semanticId\" : \"\",\n  \"identification\" : \"identification\",\n  \"idShort\" : \"idShort\",\n  \"administration\" : {\n    \"version\" : \"version\",\n    \"revision\" : \"revision\"\n  },\n  \"description\" : [ {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  }, {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  } ]\n}, {\n  \"semanticId\" : \"\",\n  \"identification\" : \"identification\",\n  \"idShort\" : \"idShort\",\n  \"administration\" : {\n    \"version\" : \"version\",\n    \"revision\" : \"revision\"\n  },\n  \"description\" : [ {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  }, {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  } ]\n} ]";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<List<SubmodelDescriptor>>(exampleJson)
            : default(List<SubmodelDescriptor>);            //TODO: Change the data returned
            return new ObjectResult(example);
        }

#pragma warning disable IDE1006 // Benennungsstile
        List<AssetAdministrationShellDescriptor> getFromAasRegistry(
#pragma warning restore IDE1006 // Benennungsstile
            string getAasIdBase64 = null,
            List<string> getAssetListBase64 = null)
        {
            List<AssetAdministrationShellDescriptor> result = new List<AssetAdministrationShellDescriptor>();

            if (getAasIdBase64 != null && getAssetListBase64 != null)
                return result;

            if (aasRegistry != null)
            {
                AssetAdministrationShellDescriptor ad = null;
                foreach (var sme in aasRegistry.SubmodelElements)
                {
                    if (sme is SubmodelElementCollection smc)
                    {
                        string aasID = "";
                        string assetID = "";
                        string descriptorJSON = "";
                        foreach (var sme2 in smc.Value)
                        {
                            if (sme2 is Property p)
                            {
                                switch (p.IdShort)
                                {
                                    case "aasID":
                                        aasID = p.Value;
                                        break;
                                    case "assetID":
                                        assetID = p.Value;
                                        break;
                                    case "descriptorJSON":
                                        descriptorJSON = p.Value;
                                        break;
                                }

                            }
                        }
                        bool found = false;
                        if (getAasIdBase64 == null && (getAssetListBase64 == null || getAssetListBase64.Count == 0))
                            found = true;
                        if (getAasIdBase64 != null)
                        {
                            if (aasID != "" && descriptorJSON != "")
                            {
                                if (getAasIdBase64 == Base64UrlEncoder.Encode(aasID))
                                {
                                    found = true;
                                }
                            }
                        }
                        if (getAssetListBase64 != null && getAssetListBase64.Count != 0)
                        {
                            if (assetID != "" && descriptorJSON != "")
                            {
                                if (getAssetListBase64.Contains(Base64UrlEncoder.Encode(assetID)))
                                {
                                    found = true;
                                }
                            }
                        }
                        if (found)
                        {
                            ad = JsonConvert.DeserializeObject<AssetAdministrationShellDescriptor>(descriptorJSON);
                            result.Add(ad);
                        }
                    }
                }
            }
            return result;
        }

        /// <summary>
        /// Returns a specific Asset Administration Shell Descriptor
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="200">Requested Asset Administration Shell Descriptor</response>
        [HttpGet]
        [Route("/registry/shell-descriptors/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("GetAssetAdministrationShellDescriptorById")]
        [SwaggerResponse(statusCode: 200, type: typeof(AssetAdministrationShellDescriptor), description: "Requested Asset Administration Shell Descriptor")]
        public virtual IActionResult GetAssetAdministrationShellDescriptorById([FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(AssetAdministrationShellDescriptor));
            /*
            string exampleJson = null;
            exampleJson = "\"\"";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<AssetAdministrationShellDescriptor>(exampleJson)
            : default(AssetAdministrationShellDescriptor);            //TODO: Change the data returned
            return new ObjectResult(example);
            */
            var timestamp = DateTime.UtcNow;
            // InitRegistry(timestamp);

            try
            {
                var aasList = getFromAasRegistry(aasIdentifier, null);

                return new ObjectResult(aasList);
            }
            catch (Exception ex)
            {
                return BadRequest(ex.Message);
            }
        }

        /// <summary>
        /// Returns a specific Submodel Descriptor
        /// </summary>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <param name="submodelIdentifier">The Submodel’s unique id (BASE64-URL-encoded)</param>
        /// <response code="200">Requested Submodel Descriptor</response>
        [HttpGet]
        [Route("/registry/shell-descriptors/{aasIdentifier}/submodel-descriptors/{submodelIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("GetSubmodelDescriptorById")]
        [SwaggerResponse(statusCode: 200, type: typeof(SubmodelDescriptor), description: "Requested Submodel Descriptor")]
        public virtual IActionResult GetSubmodelDescriptorById([FromRoute][Required] string aasIdentifier, [FromRoute][Required] string submodelIdentifier)
        {
            //TODO: Uncomment the next line to return response 200 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(200, default(SubmodelDescriptor));
            string exampleJson = null;
            exampleJson = "{\n  \"semanticId\" : \"\",\n  \"identification\" : \"identification\",\n  \"idShort\" : \"idShort\",\n  \"administration\" : {\n    \"version\" : \"version\",\n    \"revision\" : \"revision\"\n  },\n  \"description\" : [ {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  }, {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  } ]\n}";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<SubmodelDescriptor>(exampleJson)
            : default(SubmodelDescriptor);            //TODO: Change the data returned
            return new ObjectResult(example);
        }

        /// <summary>
        /// Creates all Asset identifier key-value-pair linked to an Asset Administration Shell to edit discoverable content
        /// </summary>
        /// <param name="body">Asset identifier key-value-pairs</param>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="201">Asset identifier key-value-pairs created successfully</response>
        [HttpPost]
        [Route("/lookup/shells/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("PostAllAssetLinksById")]
        [SwaggerResponse(statusCode: 201, type: typeof(List<IdentifierKeyValuePair>), description: "Asset identifier key-value-pairs created successfully")]
        public virtual IActionResult PostAllAssetLinksById([FromBody] List<IdentifierKeyValuePair> body, [FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 201 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(201, default(List<IdentifierKeyValuePair>));
            string exampleJson = null;
            exampleJson = "[ \"\", \"\" ]";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<List<IdentifierKeyValuePair>>(exampleJson)
            : default(List<IdentifierKeyValuePair>);            //TODO: Change the data returned
            return new ObjectResult(example);
        }

#pragma warning disable IDE1006 // Benennungsstile
        static void addAasToRegistry(AdminShellNS.AdminShellPackageEnv env, DateTime timestamp)
#pragma warning restore IDE1006 // Benennungsstile
        {
            var aas = env.AasEnv.AssetAdministrationShells[0];

            AssetAdministrationShellDescriptor ad = new AssetAdministrationShellDescriptor();
            //string asset = aas.assetRef?[0].Value;
            string globalAssetId = aas.AssetInformation.GlobalAssetId.GetAsExactlyOneKey().Value;

            // ad.Administration.Version = aas.administration.version;
            // ad.Administration.Revision = aas.administration.revision;
            ad.IdShort = aas.IdShort;
            ad.Identification = aas.Id;
            var e = new Models.Endpoint();
            e.ProtocolInformation = new ProtocolInformation();
            e.ProtocolInformation.EndpointAddress =
                AasxServer.Program.externalBlazor + "/shells/" +
                Base64UrlEncoder.Encode(ad.Identification);
            Console.WriteLine("AAS " + ad.IdShort + " " + e.ProtocolInformation.EndpointAddress);
            e.Interface = "AAS-1.0";
            ad.Endpoints = new List<Models.Endpoint>();
            ad.Endpoints.Add(e);
            var gr = new GlobalReference();
            gr.Value = new List<string>();
            gr.Value.Add(globalAssetId);
            ad.GlobalAssetId = gr;
            //
            var kvp = new IO.Swagger.Registry.Models.IdentifierKeyValuePair();
            kvp.Key = "assetKind";
            kvp.Value = aas.AssetInformation.AssetKind.ToString();
            gr = new GlobalReference();
            gr.Value = new List<string>();
            gr.Value.Add("assetKind");
            kvp.SubjectId = gr;
            ad.SpecificAssetIds = new List<IdentifierKeyValuePair>();
            ad.SpecificAssetIds.Add(kvp);
            //
            // Submodels
            if (aas.Submodels != null && aas.Submodels.Count > 0)
            {
                ad.SubmodelDescriptors = new List<SubmodelDescriptor>();
                foreach (var smr in aas.Submodels)
                {
                    var sm = env.AasEnv.FindSubmodel(smr);
                    if (sm != null && sm.IdShort != null)
                    {
                        SubmodelDescriptor sd = new SubmodelDescriptor();
                        sd.IdShort = sm.IdShort;
                        sd.Identification = sm.Id;
                        var esm = new Models.Endpoint();
                        esm.ProtocolInformation = new ProtocolInformation();
                        esm.ProtocolInformation.EndpointAddress =
                            AasxServer.Program.externalBlazor + "/shells/" +
                            Base64UrlEncoder.Encode(ad.Identification) + "/submodels/" +
                            Base64UrlEncoder.Encode(sd.Identification) + "/submodel/";
                        // Console.WriteLine("SM " + sd.IdShort + " " + esm.ProtocolInformation.EndpointAddress);
                        esm.Interface = "SUBMODEL-1.0";
                        sd.Endpoints = new List<Models.Endpoint>();
                        sd.Endpoints.Add(esm);
                        if (sm.SemanticId != null)
                        {
                            var sid = sm.SemanticId.GetAsExactlyOneKey();
                            if (sid != null)
                            {
                                gr = new GlobalReference();
                                gr.Value = new List<string>();
                                gr.Value.Add(sid.Value);
                                sd.SemanticId = gr;
                            }
                        }
                        // add searchData for registry
                        foreach (var se in sm.SubmodelElements)
                        {
                            var sme = se;
                            bool federate = false;
                            if (sme.SemanticId != null && sme.SemanticId.Keys != null && sme.SemanticId.Keys.Count != 0 && sme.SemanticId.Keys[0] != null)
                            {
                                if (federatedElemensSemanticId.Contains(sme.SemanticId.Keys[0].Value))
                                    federate = true;
                            }
                            if (sme.Qualifiers != null && sme.Qualifiers.Count != 0)
                            {
                                if (sme.Qualifiers[0].Type == "federatedElement")
                                    federate = true;
                            }

                            if (federate)
                            {
                                if (sd.FederatedElements == null)
                                    sd.FederatedElements = new List<string>();
                                string json = null;
                                json = JsonConvert.SerializeObject(sme, Newtonsoft.Json.Formatting.Indented,
                                    new JsonSerializerSettings
                                    {
                                        NullValueHandling = NullValueHandling.Ignore
                                    });
                                var j = Jsonization.Serialize.ToJsonObject(sme);
                                json = j.ToJsonString();
                                /*
                                if (sme is Property p)
                                {
                                    json = JsonConvert.SerializeObject(p, Newtonsoft.Json.Formatting.Indented,
                                        new JsonSerializerSettings
                                        {
                                            NullValueHandling = NullValueHandling.Ignore
                                        });
                                }
                                if (sme is SubmodelElementCollection sec)
                                {
                                    json = JsonConvert.SerializeObject(sec, Newtonsoft.Json.Formatting.Indented,
                                        new JsonSerializerSettings
                                        {
                                            NullValueHandling = NullValueHandling.Ignore
                                        });
                                }
                                */
                                /*
                                string tag = sme.idShort;
                                if (sme is AdminShell.Property p)
                                    if (p.value != "")
                                        tag += "=" + p.value;
                                */
                                if (json != null)
                                    sd.FederatedElements.Add(json);
                            }
                        }
                        ad.SubmodelDescriptors.Add(sd);
                        if (sm.IdShort.ToLower() == "nameplate")
                        {
                            // Add special entry for verifiable credentials
                            sd = new SubmodelDescriptor();
                            sd.IdShort = "NameplateVC";
                            sd.Identification = sm.Id + "_VC";
                            esm = new Models.Endpoint();
                            esm.ProtocolInformation = new ProtocolInformation();
                            esm.ProtocolInformation.EndpointAddress =
                                "https://nameplate.h2894164.stratoserver.net/demo/selfdescriptiononthefly/" +
                                "aHR0cHM6Ly9yZWdpc3RyeS5oMjg5NDE2NC5zdHJhdG9zZXJ2ZXIubmV0/" +
                                Base64UrlEncoder.Encode(ad.Identification);
                            esm.Interface = "VC-1.0";
                            sd.Endpoints = new List<Models.Endpoint>();
                            sd.Endpoints.Add(esm);
                            if (sm.SemanticId != null)
                            {
                                var sid = sm.SemanticId.GetAsExactlyOneKey();
                                if (sid != null)
                                {
                                    gr = new GlobalReference();
                                    gr.Value = new List<string>();
                                    gr.Value.Add(sid.Value);
                                    sd.SemanticId = gr;
                                }
                            }
                            ad.SubmodelDescriptors.Add(sd);
                        }
                    }
                }
            }
            // add to internal registry
            if (postRegistry.Contains("this"))
                addAasDescriptorToRegistry(ad, timestamp, true);

            // Test serialize + deserialize;
            bool test = true;
            if (test)
            {
                string json = JsonConvert.SerializeObject(ad);
                Console.WriteLine(json);
                var adTest = JsonConvert.DeserializeObject<AssetAdministrationShellDescriptor>(json);
            }

            // POST Descriptor to Registry
            foreach (var pr in postRegistry)
            {
                if (pr == "this")
                {

                    continue;
                }

                var watch = System.Diagnostics.Stopwatch.StartNew();
                string accessToken = null;
                string requestPath = pr;
                if (!requestPath.Contains("?"))
                {
                    requestPath = requestPath + "/registry/shell-descriptors";
                }
                string json = JsonConvert.SerializeObject(ad);

                var handler = new HttpClientHandler();

                if (AasxServer.AasxTask.proxy != null)
                    handler.Proxy = AasxServer.AasxTask.proxy;
                else
                    handler.DefaultProxyCredentials = CredentialCache.DefaultCredentials;

                var client = new HttpClient(handler);
                if (accessToken != null)
                    client.SetBearerToken(accessToken);

                if (json != "")
                {
                    bool error = false;
                    HttpResponseMessage response = new HttpResponseMessage();
                    try
                    {
                        Console.WriteLine("POST " + requestPath);
                        var content = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                        var task = Task.Run(async () =>
                        {
                            response = await client.PostAsync(
                                requestPath, content);
                        });
                        task.Wait();
                        error = !response.IsSuccessStatusCode;
                    }
                    catch
                    {
                        error = true;
                    }
                    if (error)
                    {
                        string r = "ERROR POST; " + response.StatusCode.ToString();
                        r += " ; " + requestPath;
                        if (response.Content != null)
                            r += " ; " + response.Content.ReadAsStringAsync().Result;
                        Console.WriteLine(r);
                    }
                }
                watch.Stop();
                Console.WriteLine(watch.ElapsedMilliseconds + " ms");
            }
        }

#pragma warning disable IDE1006 // Benennungsstile
        static void addAasDescriptorToRegistry(AssetAdministrationShellDescriptor ad, DateTime timestamp, bool initial = false)
#pragma warning restore IDE1006 // Benennungsstile
        {
            string aasID = ad.Identification;
            string assetID = "";
            if (ad.GlobalAssetId is GlobalReference gr)
            {
                assetID = gr.Value[0];
            }
            string endpoint = "";
            if (ad.Endpoints != null && ad.Endpoints.Count != 0)
            {
                endpoint = ad.Endpoints[0].ProtocolInformation.EndpointAddress;
            }
            // overwrite existing entry, if assetID AND aasID are identical
            if (!initial)
            {
                foreach (var e in aasRegistry?.SubmodelElements)
                {
                    if (e is SubmodelElementCollection ec)
                    {
                        int found = 0;
                        Property pjson = null;
                        foreach (var e2 in ec.Value)
                        {
                            if (e2 is Property ep)
                            {
                                if (ep.IdShort == "aasID" && ep.Value == aasID)
                                    found++;
                                if (ep.IdShort == "assetID" && ep.Value == assetID)
                                    found++;
                                if (ep.IdShort == "descriptorJSON")
                                    pjson = ep;
                            }
                        }
                        if (found == 2 && pjson != null)
                        {
                            string s = JsonConvert.SerializeObject(ad);
                            if (s != pjson.Value)
                            {
                                pjson.TimeStampCreate = timestamp;
                                pjson.TimeStamp = timestamp;
                                pjson.Value = s;
                                Console.WriteLine("Replace Descriptor:");
                                Console.WriteLine(s);
                            }
                            return;
                        }
                    }
                }
            }

            // add new entry
            SubmodelElementCollection c = new SubmodelElementCollection(
                idShort: "ShellDescriptor_" + aasRegistry.SubmodelElements.Count,
                value: new List<ISubmodelElement>());
            c.TimeStampCreate = timestamp;
            c.TimeStamp = timestamp;
            var p = new Property(DataTypeDefXsd.String, idShort: "idShort");
            p.TimeStampCreate = timestamp;
            p.TimeStamp = timestamp;
            p.Value = ad.IdShort;
            c.Value.Add(p);
            p = new Property(DataTypeDefXsd.String, idShort: "aasID");
            p.TimeStampCreate = timestamp;
            p.TimeStamp = timestamp;
            p.Value = aasID;
            c.Value.Add(p);
            p = new Property(DataTypeDefXsd.String, idShort: "assetID");
            p.TimeStampCreate = timestamp;
            p.TimeStamp = timestamp;
            if (assetID != "")
            {
                p.Value = assetID;
            }
            c.Value.Add(p);
            p = new Property(DataTypeDefXsd.String, idShort: "endpoint");
            p.TimeStampCreate = timestamp;
            p.TimeStamp = timestamp;
            p.Value = endpoint;
            c.Value.Add(p); p = new Property(DataTypeDefXsd.String, idShort: "descriptorJSON");
            p.TimeStampCreate = timestamp;
            p.TimeStamp = timestamp;
            p.Value = JsonConvert.SerializeObject(ad);
            c.Value.Add(p);
            aasRegistry?.SubmodelElements.Add(c);
            /*
            int federatedElementsCount = 0;
            var smc = new SubmodelElementCollection(
                idShort: "federatedElements",
                value: new List<ISubmodelElement>());
            smc.TimeStampCreate = timestamp;
            smc.TimeStamp = timestamp;
            c.Value.Add(smc);
            */
            // iterate submodels
            int iSubmodel = 0;
            foreach (var sd in ad.SubmodelDescriptors)
            {
                // add new entry
                SubmodelElementCollection cs = new SubmodelElementCollection(
                    idShort: "SubmodelDescriptor_" + submodelRegistryCount++,
                    value: new List<ISubmodelElement>());
                cs.TimeStampCreate = timestamp;
                cs.TimeStamp = timestamp;
                var ps = new Property(DataTypeDefXsd.String, idShort: "idShort");
                ps.TimeStampCreate = timestamp;
                ps.TimeStamp = timestamp;
                ps.Value = sd.IdShort;
                cs.Value.Add(ps);
                ps = new Property(DataTypeDefXsd.String, idShort: "submodelID");
                ps.TimeStampCreate = timestamp;
                ps.TimeStamp = timestamp;
                ps.Value = sd.Identification;
                cs.Value.Add(ps);
                ps = new Property(DataTypeDefXsd.String, idShort: "semanticID");
                ps.TimeStampCreate = timestamp;
                ps.TimeStamp = timestamp;
                if (sd.SemanticId != null && sd.SemanticId.Value != null)
                    ps.Value = sd.SemanticId.Value[0];
                cs.Value.Add(ps);
                if (sd.Endpoints != null && sd.Endpoints.Count != 0)
                {
                    endpoint = sd.Endpoints[0].ProtocolInformation.EndpointAddress;
                }
                ps = new Property(DataTypeDefXsd.String, idShort: "endpoint");
                ps.TimeStampCreate = timestamp;
                ps.TimeStamp = timestamp;
                ps.Value = endpoint;
                cs.Value.Add(ps);
                ps = new Property(DataTypeDefXsd.String, idShort: "descriptorJSON");
                ps.TimeStampCreate = timestamp;
                ps.TimeStamp = timestamp;
                ps.Value = JsonConvert.SerializeObject(sd);
                cs.Value.Add(ps);
                // iterate submodels
                int federatedElementsCount = 0;
                var smc = new SubmodelElementCollection(
                    idShort: "federatedElements",
                    value: new List<ISubmodelElement>());
                smc.TimeStampCreate = timestamp;
                smc.TimeStamp = timestamp;
                cs.Value.Add(smc);
                submodelRegistry?.SubmodelElements.Add(cs);
                submodelRegistry?.SetAllParents(timestamp);
                var r = new ReferenceElement(idShort: "ref_Submodel_" + iSubmodel++);
                r.TimeStampCreate = timestamp;
                r.TimeStamp = timestamp;
                var mr = cs.GetModelReference(true);
                r.Value = mr;
                // revert order in references
                int first = 0;
                int last = r.Value.Keys.Count - 1;
                while (first < last)
                {
                    var temp = r.Value.Keys[first];
                    r.Value.Keys[first] = r.Value.Keys[last];
                    r.Value.Keys[last] = temp;
                    first++;
                    last--;
                }
                c.Value.Add(r);

                if (sd.IdShort == "NameplateVC")
                {
                    if (sd.Endpoints != null && sd.Endpoints.Count > 0)
                    {
                        var ep = sd.Endpoints[0].ProtocolInformation.EndpointAddress;
                        p = new Property(DataTypeDefXsd.String, idShort: "NameplateVC");
                        p.TimeStampCreate = timestamp;
                        p.TimeStamp = timestamp;
                        p.Value = ep;
                        cs.Value.Add(p);
                    }
                }
                if (sd.FederatedElements != null && sd.FederatedElements.Count != 0)
                {
                    foreach (var fe in sd.FederatedElements)
                    {
                        try
                        {
                            federatedElementsCount++;
                            /*
                            var sme = Newtonsoft.Json.JsonConvert.DeserializeObject<ISubmodelElement>(
                                fe, new AdminShellConverters.JsonAasxConverter("modelType", "name"));
                            */
                            MemoryStream mStrm = new MemoryStream(Encoding.UTF8.GetBytes(fe));
                            JsonNode node = System.Text.Json.JsonSerializer.DeserializeAsync<JsonNode>(mStrm).Result;
                            var sme = Jsonization.Deserialize.ISubmodelElementFrom(node);

                            // p = AdminShell.Property.CreateNew("federatedElement" + federatedElementsCount);
                            sme.TimeStampCreate = timestamp;
                            sme.TimeStamp = timestamp;
                            // p.value = fe;
                            smc.Value.Add(sme);
                        }
                        catch { }
                    }
                }
            }

            aasRegistry?.SetAllParents();
        }

        public static AasCore.Aas3_0_RC02.Environment envRegistry = null;
        public static Submodel aasRegistry = null;
        public static Submodel submodelRegistry = null;
        static int aasRegistryCount = -1;
        static int submodelRegistryCount = 0;
        static List<string> postRegistry = new List<string>();
        static List<string> federatedElemensSemanticId = new List<string>();
        public static List<string> getRegistry = new List<string>();

        static bool init = false;
        static int initiallyEmpty = 0;

        static string translateURL(string url)
        {
            // get from environment
            if (url.Substring(0, 1) == "$")
            {
                string envVar = url.Substring(1);
                url = System.Environment.GetEnvironmentVariable(envVar);
            }

            return url;
        }

#pragma warning disable CS1591 // Fehledes XML-Kommentar für öffentlich sichtbaren Typ oder Element
#pragma warning disable IDE1006 // Benennungsstile
        public static void initRegistry(List<AasxCredentialsEntry> cList, DateTime timestamp, bool initAgain = false)
#pragma warning restore IDE1006 // Benennungsstile
#pragma warning restore CS1591 // Fehledes XML-Kommentar für öffentlich sichtbaren Typ oder Element
        {
            if (!initAgain && init)
            {
                AasxServer.Program.signalNewData(2);
                return;
            }

            AasxServer.Program.initializingRegistry = true;

            init = true;
            if (initAgain)
            {
                aasRegistry = null;
                submodelRegistry = null;

                int i = initiallyEmpty;
                while (i < AasxServer.Program.env.Length)
                {
                    AasxServer.Program.env[i] = null;
                    i++;
                }
            }

            if (aasRegistry == null || submodelRegistry == null)
            {
                foreach (AdminShellNS.AdminShellPackageEnv env in AasxServer.Program.env)
                {
                    if (env != null)
                    {
                        var aas = env.AasEnv.AssetAdministrationShells[0];
                        if (aas.IdShort == "REGISTRY")
                        {
                            envRegistry = env.AasEnv;
                            if (aas.Submodels != null && aas.Submodels.Count > 0)
                            {
                                foreach (var smr in aas.Submodels)
                                {
                                    var sm = env.AasEnv.FindSubmodel(smr);
                                    if (sm != null && sm.IdShort != null)
                                    {
                                        if (sm.IdShort == "AASREGISTRY")
                                            aasRegistry = sm;
                                        if (sm.IdShort == "SUBMODELREGISTRY")
                                            submodelRegistry = sm;
                                    }
                                }
                            }
                        }
                    }
                }
                if (aasRegistry != null)
                {
                    getRegistry.Clear();
                    foreach (var sme in aasRegistry.SubmodelElements)
                    {
                        if (sme is Property p)
                        {
                            if (p.IdShort.ToLower() == "postregistry")
                            {
                                string registryURL = translateURL(p.Value);
                                Console.WriteLine("POST to Registry: " + registryURL);
                                postRegistry.Add(registryURL);
                            }
                            if (p.IdShort.ToLower() == "getregistry")
                            {
                                string registryURL = translateURL(p.Value);
                                Console.WriteLine("GET from Registry: " + registryURL);
                                getRegistry.Add(registryURL);
                            }
                        }
                        if (sme is SubmodelElementCollection smc)
                        {
                            if (smc.IdShort == "federatedElements")
                            {
                                foreach (var sme2 in smc.Value)
                                {
                                    if (sme2 is Property p2)
                                    {
                                        if (p2.IdShort.Contains("semanticId"))
                                            federatedElemensSemanticId.Add(p2.Value);
                                    }
                                }
                            }
                        }
                    }
                    foreach (AdminShellNS.AdminShellPackageEnv env in AasxServer.Program.env)
                    {
                        if (env != null)
                        {
                            if (env != null)
                            {
                                var aas = env.AasEnv.AssetAdministrationShells[0];
                                if (aas.IdShort != "REGISTRY")
                                {
                                    addAasToRegistry(env, timestamp);
                                }
                            }
                        }
                    }
                }
                if (getRegistry.Count != 0)
                {
                    foreach (var greg in getRegistry)
                    {
                        List<AssetAdministrationShellDescriptor> aasDescriptors = null;

                        string json = null;
                        string accessToken = null;
                        string requestPath = greg + "/" + "registry/shell-descriptors";

                        var handler = new HttpClientHandler();

                        //
                        if (AasxServer.AasxTask.proxy != null)
                            handler.Proxy = AasxServer.AasxTask.proxy;
                        else
                            handler.DefaultProxyCredentials = CredentialCache.DefaultCredentials;
                        //

                        var client = new HttpClient(handler);
                        if (accessToken != null)
                            client.SetBearerToken(accessToken);

                        bool error = false;
                        HttpResponseMessage response = new HttpResponseMessage();
                        try
                        {
                            Console.WriteLine("GET " + requestPath);
                            var task = Task.Run(async () =>
                            {
                                response = await client.GetAsync(requestPath);
                            });
                            task.Wait();
                            json = response.Content.ReadAsStringAsync().Result;
                            aasDescriptors = JsonConvert.DeserializeObject<List<AssetAdministrationShellDescriptor>>(json);
                            error = !response.IsSuccessStatusCode;
                        }
                        catch
                        {
                            error = true;
                        }
                        if (error)
                        {
                            string r = "ERROR GET; " + response.StatusCode.ToString();
                            r += " ; " + requestPath;
                            if (response.Content != null)
                                r += " ; " + response.Content.ReadAsStringAsync().Result;
                            Console.WriteLine(r);
                        }
                        else
                        {
                            int i = 0;
                            while (i < AasxServer.Program.env.Length)
                            {
                                var env = AasxServer.Program.env[i];
                                if (env == null)
                                {
                                    break;
                                }
                                i++;
                            }
                            initiallyEmpty = i;
                            foreach (var ad in aasDescriptors)
                            {
                                if (ad.IdShort == "ZveiControlCabinetAas")
                                    continue;

                                var watch = System.Diagnostics.Stopwatch.StartNew();

                                // check, if AAS is exisiting and must be replaced
                                var aas = new AssetAdministrationShell(ad.Identification, new AssetInformation(AssetKind.Instance));
                                aas.Extensions = new List<Extension> { new Extension("endpoint", value: ad.Endpoints[0].ProtocolInformation.EndpointAddress) };
                                aas.TimeStamp = timestamp;
                                aas.TimeStampCreate = timestamp;
                                aas.IdShort = ad.IdShort + " - EXTERNAL";
                                string gid = ad.GlobalAssetId.Value[0];
                                aas.AssetInformation.GlobalAssetId = new AasCore.Aas3_0_RC02.Reference(AasCore.Aas3_0_RC02.ReferenceTypes.GlobalReference,
                                            new List<Key>() { new Key(KeyTypes.GlobalReference, gid) });
                                var newEnv = new AdminShellNS.AdminShellPackageEnv();
                                newEnv.AasEnv.AssetAdministrationShells.Add(aas);

                                foreach (var sd in ad.SubmodelDescriptors)
                                {
                                    if (sd.IdShort == "NameplateVC")
                                        continue;

                                    bool success = false;
                                    bool external = false;
                                    string idEncoded = "";
                                    string endpoint = sd.Endpoints[0].ProtocolInformation.EndpointAddress;
                                    var s1 = endpoint.Split("/shells/");
                                    if (s1.Length == 2)
                                    {
                                        var s2 = s1[1].Split("/submodels/");
                                        if (s2.Length == 2)
                                        {
                                            idEncoded = s2[1].Replace("/submodel/", ""); ;
                                            endpoint = s1[0] + "/submodels/" + idEncoded;
                                        }
                                    }
                                    requestPath = endpoint;
                                    string queryPara = "";
                                    string userPW = "";
                                    string urlEdcWrapper = "";
                                    client.DefaultRequestHeaders.Clear();
                                    if (AasxCredentials.get(cList, requestPath, out queryPara, out userPW, out urlEdcWrapper))
                                    {
                                        if (queryPara != "")
                                            queryPara = "?" + queryPara;
                                        if (userPW != "")
                                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Basic", userPW);
                                        if (urlEdcWrapper != "")
                                            requestPath = urlEdcWrapper;
                                    }

                                    AasxServer.Program.submodelAPIcount++;

                                    switch (sd.IdShort)
                                    {
                                        case "BillOfMaterial":
                                        case "ProductCarbonFootprint":
                                        case "CarbonFootprint":
                                        case "TechnicalData":
                                            // copy specific submodels locally
                                            try
                                            {
                                                requestPath += queryPara;
                                                Console.WriteLine("GET Submodel " + requestPath);
                                                var task1 = Task.Run(async () =>
                                                {
                                                    response = await client.GetAsync(requestPath);
                                                });
                                                task1.Wait();
                                                if (response.IsSuccessStatusCode)
                                                {
                                                    json = response.Content.ReadAsStringAsync().Result;
                                                    MemoryStream mStrm = new MemoryStream(Encoding.UTF8.GetBytes(json));
                                                    JsonNode node = System.Text.Json.JsonSerializer.DeserializeAsync<JsonNode>(mStrm).Result;
                                                    var sm = new Submodel("");
                                                    sm = Jsonization.Deserialize.SubmodelFrom(node);
                                                    sm.IdShort += " - COPY";
                                                    sm.Extensions = new List<Extension> { new Extension("endpoint", value: sd.Endpoints[0].ProtocolInformation.EndpointAddress) };
                                                    sm.SetAllParentsAndTimestamps(null, timestamp, timestamp);
                                                    aas.AddSubmodelReference(sm.GetReference());
                                                    newEnv.AasEnv.Submodels.Add(sm);
                                                    success = true;
                                                }
                                            }
                                            catch
                                            {
                                                success = false;
                                            }
                                            break;
                                        default:
                                            // test if submodel is accessible
                                            try
                                            {
                                                if (urlEdcWrapper == "")
                                                {
                                                    if (queryPara == "")
                                                    {
                                                        queryPara = "?level=core";
                                                    }
                                                    else
                                                    {
                                                        queryPara += "&level=core";
                                                    }
                                                }
                                                requestPath += queryPara;
                                                Console.WriteLine("GET Submodel Core " + requestPath);
                                                var task2 = Task.Run(async () =>
                                                {
                                                    response = await client.GetAsync(requestPath);
                                                });
                                                task2.Wait();
                                                if (response.IsSuccessStatusCode)
                                                {
                                                    success = true;
                                                    external = true;
                                                }
                                            }
                                            catch
                                            {
                                                success = false;
                                            }
                                            break;
                                    }

                                    if (!success || external)
                                    {
                                        var sm = new Submodel(sd.Identification);
                                        if (!success)
                                        {
                                            sm.IdShort = sd.IdShort + " - NO ACCESS";
                                        }
                                        else
                                        {
                                            if (external)
                                                sm.IdShort = sd.IdShort + " - EXTERNAL";
                                        }
                                        sm.Extensions = new List<Extension> { new Extension("endpoint", value: sd.Endpoints[0].ProtocolInformation.EndpointAddress) };
                                        sm.SetAllParentsAndTimestamps(null, timestamp, timestamp);
                                        aas.AddSubmodelReference(sm.GetReference());
                                        newEnv.AasEnv.Submodels.Add(sm);
                                    }
                                }

                                watch.Stop();
                                Console.WriteLine(watch.ElapsedMilliseconds + " ms");

                                AasxServer.Program.env[i] = newEnv;
                                i++;
                            }
                        }
                    }
                }
            }
            AasxServer.Program.signalNewData(2);

            AasxServer.Program.initializingRegistry = false;
        }

        /// <summary>
        /// Creates a new Asset Administration Shell Descriptor, i.e. registers an AAS
        /// </summary>
        /// <param name="body">Asset Administration Shell Descriptor object</param>
        /// <response code="201">Asset Administration Shell Descriptor created successfully</response>
        [HttpPost]
        [Route("/registry/shell-descriptors")]
        [ValidateModelState]
        [SwaggerOperation("PostAssetAdministrationShellDescriptor")]
        [SwaggerResponse(statusCode: 201, type: typeof(AssetAdministrationShellDescriptor), description: "Asset Administration Shell Descriptor created successfully")]
        public virtual IActionResult PostAssetAdministrationShellDescriptor([FromBody] AssetAdministrationShellDescriptor body)
        {
            //TODO: Uncomment the next line to return response 201 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(201, default(AssetAdministrationShellDescriptor));
            /*
            string exampleJson = null;
            exampleJson = "\"\"";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<AssetAdministrationShellDescriptor>(exampleJson)
            : default(AssetAdministrationShellDescriptor);            //TODO: Change the data returned
            */
            var timestamp = DateTime.UtcNow;
            // InitRegistry(timestamp);

            Console.WriteLine("POST /registry/shell-descriptors");
            bool test = true;
            if (test)
            {
                string s = JsonConvert.SerializeObject(body);
                Console.WriteLine(s);
            }

            lock (Program.changeAasxFile)
            {
                addAasDescriptorToRegistry(body, timestamp);
            }

            AasxServer.Program.signalNewData(2);

            // return new ObjectResult(example);
            return new ObjectResult("ok");
        }

        /// <summary>
        /// Creates a new Submodel Descriptor, i.e. registers a submodel
        /// </summary>
        /// <param name="body">Submodel Descriptor object</param>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="201">Submodel Descriptor created successfully</response>
        [HttpPost]
        [Route("/registry/shell-descriptors/{aasIdentifier}/submodel-descriptors")]
        [ValidateModelState]
        [SwaggerOperation("PostSubmodelDescriptor")]
        [SwaggerResponse(statusCode: 201, type: typeof(SubmodelDescriptor), description: "Submodel Descriptor created successfully")]
        public virtual IActionResult PostSubmodelDescriptor([FromBody] SubmodelDescriptor body, [FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 201 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(201, default(SubmodelDescriptor));
            string exampleJson = null;
            exampleJson = "{\n  \"semanticId\" : \"\",\n  \"identification\" : \"identification\",\n  \"idShort\" : \"idShort\",\n  \"administration\" : {\n    \"version\" : \"version\",\n    \"revision\" : \"revision\"\n  },\n  \"description\" : [ {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  }, {\n    \"language\" : \"language\",\n    \"text\" : \"text\"\n  } ]\n}";

            var example = exampleJson != null
            ? JsonConvert.DeserializeObject<SubmodelDescriptor>(exampleJson)
            : default(SubmodelDescriptor);            //TODO: Change the data returned
            return new ObjectResult(example);
        }

        /// <summary>
        /// Updates an existing Asset Administration Shell Descriptor
        /// </summary>
        /// <param name="body">Asset Administration Shell Descriptor object</param>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <response code="204">Asset Administration Shell Descriptor updated successfully</response>
        [HttpPut]
        [Route("/registry/shell-descriptors/{aasIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("PutAssetAdministrationShellDescriptorById")]
        public virtual IActionResult PutAssetAdministrationShellDescriptorById([FromBody] AssetAdministrationShellDescriptor body, [FromRoute][Required] string aasIdentifier)
        {
            //TODO: Uncomment the next line to return response 204 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(204);

            throw new NotImplementedException();
        }

        /// <summary>
        /// Updates an existing Submodel Descriptor
        /// </summary>
        /// <param name="body">Submodel Descriptor object</param>
        /// <param name="aasIdentifier">The Asset Administration Shell’s unique id (BASE64-URL-encoded)</param>
        /// <param name="submodelIdentifier">The Submodel’s unique id (BASE64-URL-encoded)</param>
        /// <response code="204">Submodel Descriptor updated successfully</response>
        [HttpPut]
        [Route("/registry/shell-descriptors/{aasIdentifier}/submodel-descriptors/{submodelIdentifier}")]
        [ValidateModelState]
        [SwaggerOperation("PutSubmodelDescriptorById")]
        public virtual IActionResult PutSubmodelDescriptorById([FromBody] SubmodelDescriptor body, [FromRoute][Required] string aasIdentifier, [FromRoute][Required] string submodelIdentifier)
        {
            //TODO: Uncomment the next line to return response 204 or use other options such as return this.NotFound(), return this.BadRequest(..), ...
            // return StatusCode(204);

            throw new NotImplementedException();
        }
    }
}
